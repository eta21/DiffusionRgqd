
---
title: "Introduction to DiffusionRgqd"
author: "Etienne A.D. Pienaar"
date: "December, 2015"
output:
  html_document:
    fig_height: 6
    fig_width: 6
    keep_md: yes
    toc: yes
  pdf_document:
    toc: yes
vignette: >
  %\VignetteIndexEntry{Part 1: Introduction to DiffusionRgqd}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---
# Introduction
__DiffusionRgqd__ is an R package for performing inference and analysis on diffusion processes, a class of continuous time, continuous state Markov processes often used in fields such as physics and finance. Diffusion processes encompass many famous stochastic processes encountered in graduate and post-graduate level statistics courses, such as Brownian motion and the [Ornstein-Uhlenbeck process](https://en.wikipedia.org/wiki/Ornstein-Uhlenbeck_process) process. Although diffusion processes are extremely useful modelling tools, performing analysis on models that are even slightly more complicated than the aforementioned models quickly become difficult. This is due in part to the fact that most diffusion models do not have analytically tractable dynamics. __DiffusionRgqd__ provides tools for performing such analysis on a class of non-linear, time inhomogeneous diffusion processes, making it possible to access non-linear diffusion processes with complicated time-inhomogeneous structures, without the need to perform any complicated mathematics beyond specifying the model of interest and peripheral parameters to the problem.

--------

# Generalized quadratic diffusions (GQDs)
__DiffusionRgqd__ is built around a class of diffusion processes with quadratic drift and diffusion specifications. That is, for an SDE:
\[dX_t = \mu(X_t,t)dt +\sigma(X_t,t)dB_t\]
where B_t is standard Brownian motion, the drift and diffusion terms assume at most second order non-linearity:
\[\mu(X_t,t) = G_0(t)+G_1(t)X_t+G_2(t)X_t^2\]
and 
\[\sigma^2(X_t,t) = Q_0(t)+Q_1(t)X_t+Q_2(t)X_t^2.\]
The purpose of this restriction is to provide a mathematical 'sandbox' within which we can calculate very accurate approximations to the transitional density of a diffusion process whilst maximizing freedom with respect to specifying time-inhomogeneous components. That is, within this framework, although we have limited the complexity of state-dependence in the drift and diffusion of the model, one has nearly complete freedom of specification for time-inhomogeneous coefficients of the model (i.e., `G0(t)`, `Q1(t)` etc.). 

--------

# Interface

Due to the freedom that the GQD framework permits, we have designed the interface of the package around a functional input system, where the user specifies the coefficients of the GQD as normal __R__-functions. For example, the SDE

\[dX_t = -\sin(2\pi t)X_tdt +dB_t\]

can be written in __R__-syntax in terms of its GQD-coefficients as

```{r,eval=FALSE}
G1=function(t){-sin(2*pi*t)}
Q0=function(t){1}
```

The idea is to provide a grammatical link between the lexical structure of a generalized diffusion model in written language, to the __R__ language. Routines in the __DiffusionRgqd__ package thus operate by searching the current __R__ workspace for pre-defined coefficient names after which it subsequently constructs the appropriate algorithm in order to perform analysis. For example, in the case of scalar GQDs, recognized function names are tabled below.

Coefficient __R__-syntax     Coefficient  __R__-syntax           
----------- ---------------- -----------  ---------------- 
$G_0(t)$    G0=function(t){} $Q_0(t)$     Q0=function(t){} 
$G_1(t)$    G1=function(t){} $Q_1(t)$     Q1=function(t){} 
$G_2(t)$    G2=function(t){} $Q_2(t)$     Q2=function(t){}   

--------

# Brownian motion with drift
Consider a stochastic differential equation 

\[dX_t = \mu dt +\sigma dB_t\]

where $B_t$ is standard Brownian motion. Then the distribution of the process $X_t$ at time t, given that it started in state $X_s$ at time s is $\mbox{Normal}(X_t,X_s+\mu(t-s),\sigma^2(t-s))$. For example:

```{r fig.align = 'center'}
Xs <- 0                 # Initial state
Xt <- seq(-3/2,3/2,1/50)# Possible future states
s  <- 0                # Starting time
t  <- 1                # Final time
mu    <- 0.5             # Drift parameter
sigma <- 0.25            # Diffusion coefficient

# True transition density
plot(dnorm(Xt,Xs+mu*(t-s),sigma*sqrt(t-s))~Xt,main='Transition density',type='l')
```

Using __DiffusionRgqd__ we can replicate the transition density of [Brownian motion with drift](https://en.wikipedia.org/wiki/Brownian_motion) by using the GQD-framework:

```{r fig.align = 'center'}
library(DiffusionRgqd) 

# Remove any existing coefficients:
GQD.remove()    

# Define the model coefficients:
G0 <- function(t){mu}
Q0 <- function(t){sigma^2}

# Calculate the transitional density:
BM <- GQD.density(Xs,Xt,s,t)

# Plot the transitional density:
plot(dnorm(Xt,Xs+mu*(t-s),sigma*sqrt(t-s))~Xt,main='Transition density',type='l')
lines(BM$density[,100]~BM$Xt,col='blue',lty='dashed',lwd=2)
```

Note the call to GQD.remove(). Due to the functional interface, it is possible to have conflicting function names in the workspace. As such GQD.remove() acts as an eraser which cleans the workspace of any existing models or function names that might clash with the pre-defined names listed for __DiffusionRgqd__. Note also the index `[,100]`: `GQD.density()` evaluates the transition density from the initial time up to and including the final transition horizon using a specified step-size. In this case the default increment of `1/100` is used. 

--------

# CIR process

Using DiffusionRgqd it is easy to generate the transitional densities of well known diffusion models nested within the GQD framework. Consider a [CIR process](https://en.wikipedia.org/wiki/Cox-Ingersoll-Ross_model) with SDE:

\[dX_t = a(b-X_t)dt+\sigma\sqrt{X_t}dB_t.\]

```{r}
 
# Remove any existing coefficients
GQD.remove()         

a = 0.5; b =5; sigma =0.35; # Some parameter values.

# Define drift Coefficients.
G0 <- function(t){a*b}    
G1 <- function(t){-a}
# Define sinusoidal diffusion coefficient.
Q1 <- function(t){sigma^2}

states     <-  seq(1,9,1/10)  # State values
initial    <-  6              # Starting value of the process
Tmax       <-  5              # Time horizon
Tstart     <-  1              # Time starts at 1
increment  <-  1/100          # Incremental time steps

# Generate the transitional density
M <- GQD.density(Xs=initial,Xt=states,s=Tstart,t=Tmax,delt=increment)

```

In order to visualize the density approximation, we can use standard R perspective plots:

```{r fig.align = 'center'}
persp(x=M$Xt,y=M$time,z=M$density,col=3,xlab='State (X_t)',ylab='Time (t)',
      zlab='Density f(X_t|X_s)',border=NA,shade=0.5,theta=145)
```

Let's see how the mean of the process evolves over time. In addition to the transitional density GQD.density() returns the cumulant equations used in the calculation of the transitional density. 

```{r fig.align = 'center'}
# What is returned:
names(M)

# Plot the mean trajectory:
plot(M$cumulants[1,]~M$time,col='blue',main='Mean trajectory',type='l')
```

And how about the variance of the process?
```{r fig.align = 'center'}
# Plot the variance trajectory:
plot(M$cumulants[2,]~M$time,col='blue',main='Variance trajectory',type='l')
```

--------

# Further reading
* [Package paper](DiffusionRgqd_Paper.pdf) and [replication materials](DiffusionRgqd_RepMaterials.html).
* [Package manual](https://cran.r-project.org/web/packages/DiffusionRgqd/DiffusionRgqd.pdf)
* More Vignettes:
    + [Introduction](Part_1_Introduction.html)
    + [Transitional densities](Part_2_Transition_Densities.html)
    + [Performing inference on diffusion processes](Part_3_Performing_Inference.html)
    + [First passage time problems](Part_4_First_Passage_Times.html)
    + Or use:
```{r,eval=FALSE}
browseVignettes('DiffusionRgqd') 
```

* Demos:

```{r,eval=FALSE}
demo(package = 'DiffusionRgqd') 
```
